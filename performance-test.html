<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HyperTypingEngine ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .performance-stats {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
        }
        .test-button {
            background: #2196f3;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        .test-button:hover {
            background: #1976d2;
        }
        .test-results {
            font-family: monospace;
            white-space: pre-wrap;
            background: #f0f0f0;
            padding: 10px;
            border-radius: 4px;
            max-height: 400px;
            overflow-y: auto;
            margin: 10px 0;
        }
        .phase-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            margin: 2px;
            font-weight: bold;
        }
        .phase-enabled { background: #4caf50; color: white; }
        .phase-disabled { background: #f44336; color: white; }
        .phase-loading { background: #ff9800; color: white; }
    </style>
</head>
<body>
    <h1>ğŸš€ HyperTypingEngine ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ</h1>
    
    <div class="test-container">
        <h2>ç¾åœ¨ã®æœ€é©åŒ–çŠ¶æ…‹</h2>
        <div id="optimization-status">
            <span class="phase-status phase-loading">Phase 1: ç¢ºèªä¸­...</span>
            <span class="phase-status phase-loading">Phase 2: ç¢ºèªä¸­...</span>
        </div>
        <div id="engine-info" class="performance-stats">
            ã‚¨ãƒ³ã‚¸ãƒ³åˆæœŸåŒ–ä¸­...
        </div>
    </div>

    <div class="test-container">
        <h2>ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ</h2>
        <button class="test-button" onclick="runBasicPerformanceTest()">åŸºæœ¬ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ</button>
        <button class="test-button" onclick="runAdvancedPerformanceTest()">é«˜è² è·ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ</button>
        <button class="test-button" onclick="runInputDelayTest()">å…¥åŠ›é…å»¶ãƒ†ã‚¹ãƒˆ</button>
        <button class="test-button" onclick="clearResults()">çµæœã‚¯ãƒªã‚¢</button>
        
        <div id="test-results" class="test-results">ãƒ†ã‚¹ãƒˆçµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...</div>
    </div>

    <script type="module">
        // HyperTypingEngineã‚’ãƒ­ãƒ¼ãƒ‰
        import { HyperTypingEngine } from './src/typing/HyperTypingEngine.js';
        
        let engine = null;
        let testResults = [];

        // ã‚¨ãƒ³ã‚¸ãƒ³ã‚’åˆæœŸåŒ–
        async function initializeEngine() {
            try {
                engine = new HyperTypingEngine();
                
                // åˆæœŸåŒ–çŠ¶æ…‹ã‚’ç¢ºèª
                updateOptimizationStatus();
                
                // ã‚¨ãƒ³ã‚¸ãƒ³æƒ…å ±ã‚’è¡¨ç¤º
                const info = await engine.getEngineInfo();
                document.getElementById('engine-info').innerHTML = `
                    <strong>ã‚¨ãƒ³ã‚¸ãƒ³æƒ…å ±:</strong><br>
                    Version: ${info.version || 'Unknown'}<br>
                    Phase 1 æœ€é©åŒ–: ${info.phase1Enabled ? 'âœ… æœ‰åŠ¹' : 'âŒ ç„¡åŠ¹'}<br>
                    Phase 2 æœ€é©åŒ–: ${info.phase2Enabled ? 'âœ… æœ‰åŠ¹' : 'âŒ ç„¡åŠ¹'}<br>
                    WebAssembly: ${info.wasmAvailable ? 'âœ… åˆ©ç”¨å¯èƒ½' : 'âŒ åˆ©ç”¨ä¸å¯'}<br>
                    åˆæœŸåŒ–æ™‚é–“: ${info.initTime || 'Unknown'}ms
                `;
                
                addResult('âœ… HyperTypingEngineåˆæœŸåŒ–å®Œäº†');
            } catch (error) {
                addResult('âŒ ã‚¨ãƒ³ã‚¸ãƒ³åˆæœŸåŒ–å¤±æ•—: ' + error.message);
                console.error('Engine initialization failed:', error);
            }
        }

        function updateOptimizationStatus() {
            // Phase 1 ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
            const phase1Status = engine?.isPhase1Enabled?.() || false;
            const phase1Element = document.querySelector('.phase-status:nth-child(1)');
            phase1Element.textContent = 'Phase 1: ' + (phase1Status ? 'æœ‰åŠ¹' : 'ç„¡åŠ¹');
            phase1Element.className = 'phase-status ' + (phase1Status ? 'phase-enabled' : 'phase-disabled');
            
            // Phase 2 ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
            const phase2Status = engine?.isPhase2Enabled?.() || false;
            const phase2Element = document.querySelector('.phase-status:nth-child(2)');
            phase2Element.textContent = 'Phase 2: ' + (phase2Status ? 'æœ‰åŠ¹' : 'ç„¡åŠ¹');
            phase2Element.className = 'phase-status ' + (phase2Status ? 'phase-enabled' : 'phase-disabled');
        }

        function addResult(message) {
            const timestamp = new Date().toLocaleTimeString();
            testResults.push(`[${timestamp}] ${message}`);
            document.getElementById('test-results').textContent = testResults.join('\n');
            
            // è‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
            const resultsElement = document.getElementById('test-results');
            resultsElement.scrollTop = resultsElement.scrollHeight;
        }

        // åŸºæœ¬ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
        window.runBasicPerformanceTest = async function() {
            if (!engine) {
                addResult('âŒ ã‚¨ãƒ³ã‚¸ãƒ³ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                return;
            }

            addResult('ğŸ§ª åŸºæœ¬ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆé–‹å§‹...');
            
            const testCases = [
                'ã“ã‚“ã«ã¡ã¯',
                'ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™',
                'ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°',
                'ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿',
                'WebAssemblyæœ€é©åŒ–'
            ];

            let totalTime = 0;
            let successCount = 0;

            for (const testCase of testCases) {
                try {
                    const startTime = performance.now();
                    
                    // ã²ã‚‰ãŒãªã‚’ãƒ­ãƒ¼ãƒå­—ã«å¤‰æ›
                    const romaji = await engine.convertHiraganaToRomaji(testCase);
                    
                    const endTime = performance.now();
                    const duration = endTime - startTime;
                    totalTime += duration;
                    successCount++;
                    
                    addResult(`âœ… "${testCase}" -> "${romaji}" (${duration.toFixed(2)}ms)`);
                } catch (error) {
                    addResult(`âŒ "${testCase}" å¤‰æ›å¤±æ•—: ${error.message}`);
                }
            }

            const averageTime = totalTime / successCount;
            addResult(`ğŸ“Š åŸºæœ¬ãƒ†ã‚¹ãƒˆå®Œäº†: å¹³å‡${averageTime.toFixed(2)}ms (${successCount}/${testCases.length}æˆåŠŸ)`);
            
            // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è©•ä¾¡
            if (averageTime < 1) {
                addResult('ğŸ‰ å„ªç§€ï¼ Phase 2 (WebAssembly) ãƒ¬ãƒ™ãƒ«ã®é«˜é€ŸåŒ–ã‚’é”æˆ');
            } else if (averageTime < 5) {
                addResult('ğŸ‘ è‰¯å¥½ï¼ Phase 1 (ã‚­ãƒ£ãƒƒã‚·ãƒ¥) ãƒ¬ãƒ™ãƒ«ã®é«˜é€ŸåŒ–ã‚’é”æˆ');
            } else {
                addResult('âš ï¸ æ”¹å–„ãŒå¿…è¦ - æœ€é©åŒ–ãŒç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§');
            }
        };

        // é«˜è² è·ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
        window.runAdvancedPerformanceTest = async function() {
            if (!engine) {
                addResult('âŒ ã‚¨ãƒ³ã‚¸ãƒ³ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                return;
            }

            addResult('ğŸ”¥ é«˜è² è·ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆé–‹å§‹...');
            
            const iterations = 1000;
            const testString = 'ã“ã‚Œã¯ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã§ã™';
            
            const startTime = performance.now();
            
            let successCount = 0;
            for (let i = 0; i < iterations; i++) {
                try {
                    await engine.convertHiraganaToRomaji(testString);
                    successCount++;
                } catch (error) {
                    // ã‚¨ãƒ©ãƒ¼ã‚«ã‚¦ãƒ³ãƒˆ
                }
            }
            
            const endTime = performance.now();
            const totalTime = endTime - startTime;
            const averageTime = totalTime / iterations;
            const opsPerSecond = 1000 / averageTime;
            
            addResult(`ğŸ“Š é«˜è² è·ãƒ†ã‚¹ãƒˆçµæœ:`);
            addResult(`   ç·æ™‚é–“: ${totalTime.toFixed(2)}ms`);
            addResult(`   å¹³å‡æ™‚é–“: ${averageTime.toFixed(3)}ms`);
            addResult(`   å‡¦ç†èƒ½åŠ›: ${opsPerSecond.toFixed(0)} ops/sec`);
            addResult(`   æˆåŠŸç‡: ${((successCount / iterations) * 100).toFixed(1)}%`);
            
            // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ¤å®š
            if (opsPerSecond > 1000) {
                addResult('ğŸš€ Phase 2 (WebAssembly) ãƒ¬ãƒ™ãƒ«: 10-100xé«˜é€ŸåŒ–é”æˆï¼');
            } else if (opsPerSecond > 200) {
                addResult('âš¡ Phase 1 (ã‚­ãƒ£ãƒƒã‚·ãƒ¥) ãƒ¬ãƒ™ãƒ«: 2-5xé«˜é€ŸåŒ–é”æˆï¼');
            } else {
                addResult('ğŸ˜Ÿ æœ€é©åŒ–æœªé©ç”¨: ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³æ€§èƒ½');
            }
        };

        // å…¥åŠ›é…å»¶ãƒ†ã‚¹ãƒˆ
        window.runInputDelayTest = async function() {
            if (!engine) {
                addResult('âŒ ã‚¨ãƒ³ã‚¸ãƒ³ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                return;
            }

            addResult('âŒ¨ï¸ å…¥åŠ›é…å»¶ãƒ†ã‚¹ãƒˆé–‹å§‹...');
            
            const inputSequence = 'konnichiha';
            const delays = [];
            
            for (let i = 0; i < inputSequence.length; i++) {
                const char = inputSequence[i];
                const startTime = performance.now();
                
                try {
                    // æ–‡å­—å…¥åŠ›å‡¦ç†ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
                    await engine.processInput(char);
                    
                    const endTime = performance.now();
                    const delay = endTime - startTime;
                    delays.push(delay);
                    
                    addResult(`âŒ¨ï¸ "${char}" å…¥åŠ›å‡¦ç†: ${delay.toFixed(2)}ms`);
                } catch (error) {
                    addResult(`âŒ "${char}" å…¥åŠ›ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                }
                
                // å®Ÿéš›ã®ã‚¿ã‚¤ãƒ”ãƒ³ã‚°é–“éš”ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ (100ms)
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            const averageDelay = delays.reduce((a, b) => a + b, 0) / delays.length;
            const maxDelay = Math.max(...delays);
            
            addResult(`ğŸ“Š å…¥åŠ›é…å»¶ãƒ†ã‚¹ãƒˆçµæœ:`);
            addResult(`   å¹³å‡é…å»¶: ${averageDelay.toFixed(2)}ms`);
            addResult(`   æœ€å¤§é…å»¶: ${maxDelay.toFixed(2)}ms`);
            
            if (maxDelay < 5) {
                addResult('âœ… å„ªç§€ï¼ å…¥åŠ›é…å»¶ãªã—');
            } else if (maxDelay < 20) {
                addResult('ğŸ‘ è‰¯å¥½ï¼ è¨±å®¹ç¯„å›²å†…ã®é…å»¶');
            } else {
                addResult('âš ï¸ æ”¹å–„å¿…è¦ - å…¥åŠ›é…å»¶ãŒç™ºç”Ÿ');
            }
        };

        window.clearResults = function() {
            testResults = [];
            document.getElementById('test-results').textContent = 'ãƒ†ã‚¹ãƒˆçµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...';
        };

        // åˆæœŸåŒ–
        initializeEngine();
    </script>
</body>
</html>
